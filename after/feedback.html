<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë´íŠ¸ì°°ë¦¬ - í”¼ë“œë°± í™”ë©´</title>
    <style>
        :root {
            --bg-dark: #222831;
            --panel-dark: #2b313a;
            --panel-darker: #1c2129;
            --accent-teal: #1dd1a1;
            --accent-blue: #00a3ff;
            --accent-orange: #ff7f50;
            --text-bright: #f5f9ff;
            --text-muted: #c6ccd7;
            --border-glow: rgba(0, 255, 224, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Noto Sans KR", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-bright);
            line-height: 1.6;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 48px 20px 80px;
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        section {
            background: var(--panel-dark);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .summary-header {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .summary-header h1 {
            font-size: 2rem;
            letter-spacing: -0.02em;
        }

        .score-highlight {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--accent-teal);
        }

        .metrics-grid {
            margin-top: 32px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        .metric-card {
            background: var(--panel-darker);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.04);
        }

        .progress-bar {
            margin-top: 12px;
            height: 8px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.08);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 999px;
            background: linear-gradient(90deg, #00f1c8, #00a0ff);
        }

        .ccg-checklist {
            margin-top: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
        }

        .ccg-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.03);
        }

        .ccg-item .icon {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            font-size: 1rem;
            font-weight: 600;
        }

        .ccg-item.pass .icon {
            background: rgba(29, 209, 161, 0.15);
            color: var(--accent-teal);
        }

        .ccg-item.fail .icon {
            background: rgba(255, 127, 80, 0.15);
            color: var(--accent-orange);
        }

        .improvements {
            margin-top: 28px;
            background: rgba(0, 0, 0, 0.25);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.04);
        }

        .improvements h3 {
            font-size: 1.1rem;
            margin-bottom: 12px;
        }

        .improvements ul {
            list-style: disc;
            margin-left: 20px;
            color: var(--text-muted);
        }

        .history-section h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .history-wrapper {
            display: flex;
            flex-direction: column;
            gap: 18px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 6px;
        }

        .history-wrapper::-webkit-scrollbar {
            width: 6px;
        }

        .history-wrapper::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 999px;
        }

        .conversation-entry {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-row {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .chat-row.me {
            flex-direction: row-reverse;
        }

        .avatar {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(255, 255, 255, 0.08);
            object-fit: cover;
        }

        .chat-bubble {
            max-width: 70%;
            padding: 16px;
            border-radius: 16px;
            font-size: 0.95rem;
            color: #f2f3f8;
        }

        .patient .chat-bubble {
            background: rgba(255, 255, 255, 0.05);
        }

        .me .chat-bubble {
            background: rgba(0, 163, 255, 0.15);
            border: 1px solid rgba(0, 163, 255, 0.3);
        }

        .feedback-box {
            margin-left: 54px;
            max-width: 70%;
            padding: 14px 16px;
            border-radius: 12px;
            font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .feedback-box.positive {
            background: rgba(76, 175, 80, 0.15);
            color: #81c784;
            border-color: rgba(76, 175, 80, 0.3) !important;
        }

        .feedback-box.improve {
            background: rgba(244, 67, 54, 0.15);
            color: #ef5350;
            border-color: rgba(244, 67, 54, 0.3) !important;
        }

        .actions {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 14px 28px;
            border-radius: 999px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }

        .btn.primary {
            background: var(--accent-teal);
            color: #032b25;
        }

        .btn.secondary {
            border: 1px solid rgba(255, 255, 255, 0.25);
            background: transparent;
            color: var(--text-bright);
        }

        .btn:hover {
            transform: translateY(-2px);
            opacity: 0.95;
        }

        @media (max-width: 768px) {
            section {
                padding: 24px;
            }

            .chat-bubble,
            .feedback-box {
                max-width: 100%;
            }

            .chat-row,
            .chat-row.me {
                flex-direction: column;
                align-items: flex-start;
            }

            .chat-row.me .chat-bubble,
            .chat-row.me .feedback-box {
                margin-left: 54px;
            }
        }
    </style>
</head>
<body>
    <main>
        <!-- <section class="summary-section">
            <div class="summary-header">
                <p class="eyebrow">DentCharlie Simulation</p>
                <h1>ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ ë° ë¶„ì„</h1> 
                <div class="score-highlight">ì´ì  85ì </div>
                <p class="summary-copy">ì „ì²´ CCG íë¦„ ì¤‘ 4ê°œ ë‹¨ê³„ë¥¼ ì™„ìˆ˜í–ˆìœ¼ë©°, ì •ë³´ ìˆ˜ì§‘ê³¼ ê³µê° í‘œí˜„ì—ì„œ ê°•ì ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.</p>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <p>ì„¸ì…˜ ì‹œì‘ Â· Rapport</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 92%;"></div>
                    </div>
                    <small>92% ë‹¬ì„±</small>
                </div>
                <div class="metric-card">
                    <p>ì •ë³´ ìˆ˜ì§‘ Â· Needs Discovery</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 78%;"></div>
                    </div>
                    <small>78% ë‹¬ì„±</small>
                </div>
                <div class="metric-card">
                    <p>ê³µê° Â· ê´€ê³„ ìœ ì§€</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 64%;"></div>
                    </div>
                    <small>64% ë‹¬ì„±</small>
                </div>
            </div>

            <div class="ccg-checklist" id="rubric-checklist">
                ë£¨ë¸Œë¦­ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë Œë”ë§ë¨ 
            </div>

            <div class="improvements" id="improvements-section" style="display: none;">
                <h3>ë‹¤ìŒ ì—°ìŠµì—ì„œ ì§‘ì¤‘í•  ê°œì„  í¬ì¸íŠ¸</h3>
                <ul id="improvements-list"></ul>
            </div>
        </section> -->

        <section class="history-section">
            <h2>ëŒ€í™” ë³µê¸°</h2>
            <div class="history-wrapper" id="conversation-wrapper">
                <!-- ëŒ€í™”ê°€ ì—¬ê¸°ì— ë Œë”ë§ë¨ -->
            </div>
        </section>

        <section class="history-section">
            <h2>ê²°ê³¼ ë¶„ì„</h2>
            <!-- âœ… í”¼ë“œë°± ìƒì„± ì¤‘ ë¡œë”© í™”ë©´ -->
            <div id="loading-state" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 1.2rem; margin-bottom: 20px; color: var(--text-bright);">í”¼ë“œë°±ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</div>
                <div style="display: inline-block; width: 50px; height: 50px; border: 4px solid rgba(0, 163, 255, 0.2); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                <style>
                    @keyframes spin {
                        to { transform: rotate(360deg); }
                    }
                </style>
            </div>
            
            <!-- âœ… ë£¨ë¸Œë¦­ ì²´í¬ë¦¬ìŠ¤íŠ¸ (í”¼ë“œë°± ì™„ë£Œ í›„ í‘œì‹œ) -->
            <div id="feedback-content" style="display: none;">
                <div class="ccg-checklist" id="rubric-checklist">
                    <!-- ë£¨ë¸Œë¦­ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë Œë”ë§ë¨ -->
                </div>

                <div class="improvements" id="improvements-section" style="display: none; margin-top: 24px;">
                    <h3>ë‹¤ìŒ ì—°ìŠµì—ì„œ ì§‘ì¤‘í•  ê°œì„  í¬ì¸íŠ¸</h3>
                    <ul id="improvements-list"></ul>
                </div>
            </div>
        </section>

        <section class="history-section">
            <h2>ğŸ“š ëŒ€í™” ì˜ˆì‹œ</h2>
            <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 0.95rem;">ê° ë‹¨ê³„ë³„ ì¢‹ì€ ì˜ˆì‹œì™€ ê°œì„  ì˜ˆì‹œë¥¼ ë¹„êµí•˜ë©° í•™ìŠµí•˜ì„¸ìš”.</p>
            
            <div id="example-section" style="background: var(--panel-dark); border-radius: 20px; padding: 32px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35); border: 1px solid rgba(255, 255, 255, 0.05); display: none;">
                <!-- ì§„ë£Œ íë¦„ í•œëˆˆì— ë³´ê¸° -->
                <div style="background: var(--panel-darker); border: 1px solid rgba(0, 163, 255, 0.3); padding: 20px; border-radius: 16px; margin-bottom: 24px;">
                    <p style="color: var(--text-muted); font-size: 0.9rem; margin: 0;">
                        <strong style="color: var(--accent-blue);">5ë‹¨ê³„ ì§„ë£Œ íë¦„:</strong>
                        <span style="display: inline-block; margin-left: 12px;">
                            <span style="color: #81c784;">1ï¸âƒ£ ì¸ì‚¬ ë° í™˜ì í™•ì¸</span>
                            <span style="margin: 0 8px; color: var(--text-muted);">â†’</span>
                            <span style="color: #81c784;">2ï¸âƒ£ ë°©ë¬¸ ì´ìœ  í™•ì¸</span>
                            <span style="margin: 0 8px; color: var(--text-muted);">â†’</span>
                            <span style="color: #81c784;">3ï¸âƒ£ ì •ë³´ ìˆ˜ì§‘ & ê³µê°</span>
                            <span style="margin: 0 8px; color: var(--text-muted);">â†’</span>
                            <span style="color: #81c784;">4ï¸âƒ£ ì¹˜ë£Œ ê³„íš ì„¤ëª…</span>
                            <span style="margin: 0 8px; color: var(--text-muted);">â†’</span>
                            <span style="color: #81c784;">5ï¸âƒ£ ì§„ë£Œ ë§ˆë¬´ë¦¬</span>
                        </span>
                    </p>
                </div>

                <div style="display: flex; flex-direction: column; gap: 32px;">
                    <!-- 1ë‹¨ê³„ -->
                    <div style="border: 2px solid rgba(0, 163, 255, 0.3); border-radius: 12px; padding: 20px; background: rgba(0, 163, 255, 0.02);">
                        <h4 style="color: var(--accent-blue); margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.5rem;">1ï¸âƒ£</span>
                            <span>ì¸ì‚¬ ë° í™˜ì í™•ì¸</span>
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <!-- ì¢‹ì€ ì˜ˆì‹œ -->
                            <div style="background: rgba(76, 175, 80, 0.08); border: 1px solid rgba(76, 175, 80, 0.3); padding: 16px; border-radius: 12px;">
                                <strong style="color: #81c784; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span>âœ… ì¢‹ì€ ì˜ˆì‹œ</span>
                                </strong>
                                <p style="color: var(--text-muted); margin-top: 10px; font-size: 0.9rem;">
                                    "ì•ˆë…•í•˜ì„¸ìš”. ì €ëŠ” ì¹˜ê³¼ì˜ì‚¬ ê¹€â—‹â—‹ì…ë‹ˆë‹¤. â—‹â—‹â—‹ë‹˜ ë§ìœ¼ì‹ ê°€ìš”?"
                                </p>
                                <div style="background: rgba(29, 209, 161, 0.1); border: 1px solid rgba(29, 209, 161, 0.3); padding: 8px; border-radius: 6px; margin-top: 10px;">
                                    <small style="color: #81c784;">í™˜ì ì´ë¦„ê³¼ ìì‹ ì„ ëª…í™•íˆ ì†Œê°œí•˜ê³  í¸í•˜ê²Œ ì¸ì‚¬.</small>
                                </div>
                            </div>
                            <!-- ê°œì„  ì˜ˆì‹œ -->
                            <div style="background: rgba(255, 127, 80, 0.08); border: 1px solid rgba(255, 127, 80, 0.3); padding: 16px; border-radius: 12px;">
                                <strong style="color: #ff7f50; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span>âŒ ê°œì„  í•„ìš”</span>
                                </strong>
                                <p style="color: var(--text-muted); margin-top: 10px; font-size: 0.9rem;">
                                    "ì•ˆë…•í•˜ì„¸ìš”. ë­ í•˜ì…¨ì–´ìš”?"
                                </p>
                                <div style="background: rgba(255, 127, 80, 0.1); border: 1px solid rgba(255, 127, 80, 0.3); padding: 8px; border-radius: 6px; margin-top: 10px;">
                                    <small style="color: #ff7f50;">ìì‹ ì˜ ì†Œê°œê°€ ì—†ê³ , í™˜ì ì´ë¦„ ë¯¸í™•ì¸.</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2ë‹¨ê³„ -->
                    <div style="border: 2px solid rgba(0, 163, 255, 0.3); border-radius: 12px; padding: 20px; background: rgba(0, 163, 255, 0.02);">
                        <h4 style="color: var(--accent-blue); margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.5rem;">2ï¸âƒ£</span>
                            <span>ë°©ë¬¸ ì´ìœ  í™•ì¸</span>
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <!-- ì¢‹ì€ ì˜ˆì‹œ -->
                            <div style="background: rgba(76, 175, 80, 0.08); border: 1px solid rgba(76, 175, 80, 0.3); padding: 16px; border-radius: 12px;">
                                <strong style="color: #81c784; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span>âœ… ì¢‹ì€ ì˜ˆì‹œ</span>
                                </strong>
                                <p style="color: var(--text-muted); margin-top: 10px; font-size: 0.9rem;">
                                    "ì˜¤ëŠ˜ ì–´ë–¤ ë¶ˆí¸í•¨ìœ¼ë¡œ ë°©ë¬¸í•˜ì…¨ì–´ìš”?"
                                </p>
                                <div style="background: rgba(29, 209, 161, 0.1); border: 1px solid rgba(29, 209, 161, 0.3); padding: 8px; border-radius: 6px; margin-top: 10px;">
                                    <small style="color: #81c784;">ê°œë°©í˜• ì§ˆë¬¸ìœ¼ë¡œ ì£¼ìš” ì¦ìƒ ì´ëŒì–´ë‚´ê¸°.</small>
                                </div>
                            </div>
                            <!-- ê°œì„  ì˜ˆì‹œ -->
                            <div style="background: rgba(255, 127, 80, 0.08); border: 1px solid rgba(255, 127, 80, 0.3); padding: 16px; border-radius: 12px;">
                                <strong style="color: #ff7f50; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span>âŒ ê°œì„  í•„ìš”</span>
                                </strong>
                                <p style="color: var(--text-muted); margin-top: 10px; font-size: 0.9rem;">
                                    "ì¶©ì¹˜ ìˆìœ¼ì„¸ìš”?"<br/>
                                    "ì´ë¹¨ í”ë“¤ë¦¬ì„¸ìš”?"
                                </p>
                                <div style="background: rgba(255, 127, 80, 0.1); border: 1px solid rgba(255, 127, 80, 0.3); padding: 8px; border-radius: 6px; margin-top: 10px;">
                                    <small style="color: #ff7f50;">íì‡„í˜• ì§ˆë¬¸ìœ¼ë¡œ ì£¼í˜¸ì†Œ ë†“ì¹˜ê¸° ì‰¬ì›€.</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3ë‹¨ê³„ -->
                    <div style="border: 2px solid rgba(0, 163, 255, 0.3); border-radius: 12px; padding: 20px; background: rgba(0, 163, 255, 0.02);">
                        <h4 style="color: var(--accent-blue); margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.5rem;">3ï¸âƒ£</span>
                            <span>ì •ë³´ ìˆ˜ì§‘ ë° ê³µê°</span>
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <!-- ì¢‹ì€ ì˜ˆì‹œ -->
                            <div style="background: rgba(76, 175, 80, 0.08); border: 1px solid rgba(76, 175, 80, 0.3); padding: 16px; border-radius: 12px;">
                                <strong style="color: #81c784; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span>âœ… ì¢‹ì€ ì˜ˆì‹œ</span>
                                </strong>
                                <p style="color: var(--text-muted); margin-top: 10px; font-size: 0.9rem;">
                                    í™˜ì: "ì…ì´ ì“°ë¼ë ¤ìš”."<br/>
                                    ì˜ì‚¬: "ì–¸ì œë¶€í„°? ì–´ë–¤ ìƒí™©ì—ì„œ?"<br/>
                                    í™˜ì: "ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì„ ë•Œ."<br/>
                                    ì˜ì‚¬: "ê·¸ë ‡êµ°ìš”. ì´í•´í•©ë‹ˆë‹¤."
                                </p>
                                <div style="background: rgba(29, 209, 161, 0.1); border: 1px solid rgba(29, 209, 161, 0.3); padding: 8px; border-radius: 6px; margin-top: 10px;">
                                    <small style="color: #81c784;">ì¶”ê°€ ì§ˆë¬¸ìœ¼ë¡œ ì •ë³´ ìˆ˜ì§‘ + ê³µê° í‘œí˜„.</small>
                                </div>
                            </div>
                            <!-- ê°œì„  ì˜ˆì‹œ -->
                            <div style="background: rgba(255, 127, 80, 0.08); border: 1px solid rgba(255, 127, 80, 0.3); padding: 16px; border-radius: 12px;">
                                <strong style="color: #ff7f50; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span>âŒ ê°œì„  í•„ìš”</span>
                                </strong>
                                <p style="color: var(--text-muted); margin-top: 10px; font-size: 0.9rem;">
                                    í™˜ì: "ì…ì´ ì“°ë¼ë ¤ìš”."<br/>
                                    ì˜ì‚¬: "ê·¸ë ‡êµ°ìš”. ì²˜ë°©ì•½ ë“œë¦´ê²Œìš”."
                                </p>
                                <div style="background: rgba(255, 127, 80, 0.1); border: 1px solid rgba(255, 127, 80, 0.3); padding: 8px; border-radius: 6px; margin-top: 10px;">
                                    <small style="color: #ff7f50;">ì •ë³´ ìˆ˜ì§‘ ì—†ì´ ë°”ë¡œ ì¹˜ë£Œë§Œ ì œì‹œ.</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 4ë‹¨ê³„ -->
                    <div style="border: 2px solid rgba(0, 163, 255, 0.3); border-radius: 12px; padding: 20px; background: rgba(0, 163, 255, 0.02);">
                        <h4 style="color: var(--accent-blue); margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.5rem;">4ï¸âƒ£</span>
                            <span>ì¹˜ë£Œ ê³„íš ì„¤ëª…</span>
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <!-- ì¢‹ì€ ì˜ˆì‹œ -->
                            <div style="background: rgba(76, 175, 80, 0.08); border: 1px solid rgba(76, 175, 80, 0.3); padding: 16px; border-radius: 12px;">
                                <strong style="color: #81c784; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span>âœ… ì¢‹ì€ ì˜ˆì‹œ</span>
                                </strong>
                                <p style="color: var(--text-muted); margin-top: 10px; font-size: 0.9rem;">
                                    "ë¨¼ì € ì•½ë¬¼ ì¹˜ë£Œë¡œ ì‹œì‘í•´ë³´ê³ , 2ì£¼ í›„ ê²½ê³¼ë¥¼ ë´…ì‹œë‹¤. ê·¸ë•Œë„ ì¦ìƒì´ ìˆìœ¼ë©´ ì¶”ê°€ ì‹œìˆ ì„ ê³ ë ¤í•´ë´…ì‹œë‹¤."
                                </p>
                                <div style="background: rgba(29, 209, 161, 0.1); border: 1px solid rgba(29, 209, 161, 0.3); padding: 8px; border-radius: 6px; margin-top: 10px;">
                                    <small style="color: #81c784;">ë‹¨ê³„ë³„ ê³„íšê³¼ ì„ íƒì§€ ëª…í™•íˆ ì œì‹œ.</small>
                                </div>
                            </div>
                            <!-- ê°œì„  ì˜ˆì‹œ -->
                            <div style="background: rgba(255, 127, 80, 0.08); border: 1px solid rgba(255, 127, 80, 0.3); padding: 16px; border-radius: 12px;">
                                <strong style="color: #ff7f50; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span>âŒ ê°œì„  í•„ìš”</span>
                                </strong>
                                <p style="color: var(--text-muted); margin-top: 10px; font-size: 0.9rem;">
                                    "ìˆ˜ìˆ í•˜ëŠ” ê²Œ ë‚«ê² ëŠ”ë°ìš”. ë¹„ìš©ì€ ë’¤ì—ì„œ ê³„ì‚°í•˜ì„¸ìš”."
                                </p>
                                <div style="background: rgba(255, 127, 80, 0.1); border: 1px solid rgba(255, 127, 80, 0.3); padding: 8px; border-radius: 6px; margin-top: 10px;">
                                    <small style="color: #ff7f50;">í™˜ì ë™ì˜ ì—†ì´ ê²°ì •, ì„¤ëª… ë¶€ì¡±.</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 5ë‹¨ê³„ -->
                    <div style="border: 2px solid rgba(0, 163, 255, 0.3); border-radius: 12px; padding: 20px; background: rgba(0, 163, 255, 0.02);">
                        <h4 style="color: var(--accent-blue); margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.5rem;">5ï¸âƒ£</span>
                            <span>ì§„ë£Œ ë§ˆë¬´ë¦¬</span>
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <!-- ì¢‹ì€ ì˜ˆì‹œ -->
                            <div style="background: rgba(76, 175, 80, 0.08); border: 1px solid rgba(76, 175, 80, 0.3); padding: 16px; border-radius: 12px;">
                                <strong style="color: #81c784; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span>âœ… ì¢‹ì€ ì˜ˆì‹œ</span>
                                </strong>
                                <p style="color: var(--text-muted); margin-top: 10px; font-size: 0.9rem;">
                                    "2ì£¼ í›„ì— ë‹¤ì‹œ ëµ™ê² ìŠµë‹ˆë‹¤. ì§‘ì—ì„œëŠ” ìê·¹ì ì¸ ìŒì‹ì„ í”¼í•˜ì‹œê³ , ì–‘ì¹˜ì§ˆì€ ë¶€ë“œëŸ½ê²Œ í•´ì£¼ì„¸ìš”. ë¬¸ì œ ìˆìœ¼ë©´ ì¹˜ê³¼ë¡œ ì—°ë½ ì£¼ì„¸ìš”."
                                </p>
                                <div style="background: rgba(29, 209, 161, 0.1); border: 1px solid rgba(29, 209, 161, 0.3); padding: 8px; border-radius: 6px; margin-top: 10px;">
                                    <small style="color: #81c784;">ì¬ë°©ë¬¸ ì¼ì •, ìê°€ ê´€ë¦¬, ì—°ë½ì²˜ ì™„ë²½ ì•ˆë‚´.</small>
                                </div>
                            </div>
                            <!-- ê°œì„  ì˜ˆì‹œ -->
                            <div style="background: rgba(255, 127, 80, 0.08); border: 1px solid rgba(255, 127, 80, 0.3); padding: 16px; border-radius: 12px;">
                                <strong style="color: #ff7f50; font-size: 0.95rem; display: flex; align-items: center; gap: 8px;">
                                    <span>âŒ ê°œì„  í•„ìš”</span>
                                </strong>
                                <p style="color: var(--text-muted); margin-top: 10px; font-size: 0.9rem;">
                                    "ì•½ ë¨¹ìœ¼ì„¸ìš”. ë‚˜ì¤‘ì— ë´…ì‹œë‹¤."
                                </p>
                                <div style="background: rgba(255, 127, 80, 0.1); border: 1px solid rgba(255, 127, 80, 0.3); padding: 8px; border-radius: 6px; margin-top: 10px;">
                                    <small style="color: #ff7f50;">ì¬ë°©ë¬¸ ì¼ì • ì—†ìŒ, ì„¤ëª… ë¶€ì¡±.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div style="display: flex; gap: 12px; justify-content: center; margin-top: 32px;">
            <button class="btn primary" id="retry-btn">ë‹¤ì‹œ ì—°ìŠµí•˜ê¸°</button>
            <button class="btn secondary" id="back-to-cases-btn">ì¼€ì´ìŠ¤ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </main>
    <script>
        // âœ… í…ŒìŠ¤íŠ¸ìš© í”¼ë“œë°± ì˜ˆì‹œ ë°ì´í„° ìƒì„±
        function createMockFeedbackData() {
            const mockData = {
                caseId: 'lee-jiwon',
                items: [
                    { role: 'patient', text: 'ì•ˆë…•í•˜ì„¸ìš”. ì €ëŠ” ì¹˜ê³¼ì˜ì‚¬ ê¹€â—‹â—‹ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ì–´ë–¤ ë¶ˆí¸í•¨ìœ¼ë¡œ ë°©ë¬¸í•˜ì…¨ì–´ìš”?' },
                    { role: 'user', text: 'ì… ì•ˆì´ ì¢€ ì“°ë¼ë¦¬ê³  ìµœê·¼ì— ì–‘ìª½ ì…ìˆ  ì•ˆì´ ë¶€ì—ˆì–´ìš”.' },
                    { role: 'patient', text: 'ê·¸ë ‡êµ°ìš”. ì–¸ì œë¶€í„° ê·¸ëŸ° ì¦ìƒì´ ìˆì—ˆë‚˜ìš”?' },
                    { role: 'user', text: 'ì•½ ì¼ì£¼ì¼ ì „ë¶€í„°ìš”. ìŒì‹ì„ ì”¹ì„ ë•Œ ì¢€ ë¶ˆí¸í•©ë‹ˆë‹¤.' },
                    { role: 'patient', text: 'ì²˜ìŒ ì¦ìƒì´ ë‚˜íƒ€ë‚¬ì„ ë•Œì™€ ë¹„êµí•´ì„œ ë‚˜ì•„ì§„ ê±´ ì—†ë‚˜ìš”?' },
                    { role: 'user', text: 'ìŒ.. ìš”ì¦˜ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë§ì´ ë°›ê³  ìˆëŠ”ë° ê·¸ ë•Œë¬¸ì¼ ìˆ˜ë„ ìˆê² ë„¤ìš”.' },
                    { role: 'patient', text: 'ê·¸ë ‡êµ°ìš”. ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ìˆì„ ë•Œ êµ¬ê°• ì§ˆí™˜ì´ ì•…í™”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ê²€ì‚¬ë¥¼ ì¢€ í•´ë³´ê² ìŠµë‹ˆë‹¤.' },
                    { role: 'user', text: 'ì•Œê² ìŠµë‹ˆë‹¤. ì¹˜ë£Œí•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?' },
                    { role: 'patient', text: 'ì¼ë‹¨ ì•½ë¬¼ ì¹˜ë£Œë¡œ ì‹œì‘í•´ë³´ê³ , ì¦ìƒì´ ì¢‹ì•„ì§€ì§€ ì•Šìœ¼ë©´ ë‹¤ë¥¸ ì‹œìˆ ë„ ê³ ë ¤í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 2ì£¼ í›„ì— ë‹¤ì‹œ ë°©ë¬¸í•´ì£¼ì„¸ìš”.' },
                    { role: 'user', text: 'ë„¤, ê°ì‚¬í•©ë‹ˆë‹¤. ì¡°ì‹¬í•˜ê² ìŠµë‹ˆë‹¤.' }
                ],
                feedbacks: [
                    { stage: '1ë‹¨ê³„: ì¸ì‚¬ ë° í™˜ì í™•ì¸', done: true, text: 'í™˜ì ì´ë¦„ê³¼ ìì‹ ì„ ëª…í™•íˆ ì†Œê°œí•˜ê³  í¸í•˜ê²Œ ì¸ì‚¬í–ˆìŠµë‹ˆë‹¤.' },
                    { stage: '2ë‹¨ê³„: ë°©ë¬¸ ì´ìœ  í™•ì¸', done: true, text: 'ê°œë°©í˜• ì§ˆë¬¸ìœ¼ë¡œ í™˜ìì˜ ì£¼ìš” ì¦ìƒì„ ì´ëŒì–´ë‚´ì—ˆìŠµë‹ˆë‹¤.' },
                    { stage: '3ë‹¨ê³„: ì •ë³´ ìˆ˜ì§‘ ë° ê³µê°', done: true, text: 'ì¦ìƒì˜ ë°œìƒ ì‹œê¸°ì™€ ìŠ¤íŠ¸ë ˆìŠ¤ ìš”ì¸ì„ íŒŒì•…í•˜ë ¤ê³  ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.' },
                    { stage: '4ë‹¨ê³„: ì¹˜ë£Œ ê³„íš ì„¤ëª…', done: true, text: 'ì•½ë¬¼ ì¹˜ë£Œì™€ ì¶”ê°€ ì‹œìˆ  ì˜µì…˜ì„ ëª…í™•í•˜ê²Œ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤.' },
                    { stage: '5ë‹¨ê³„: ì§„ë£Œ ë§ˆë¬´ë¦¬', done: true, text: 'ì¬ë°©ë¬¸ ì¼ì •ì„ êµ¬ì²´ì ìœ¼ë¡œ ì•ˆë‚´í–ˆìŠµë‹ˆë‹¤.' }
                ],
                isGenerating: false
            };
            return mockData;
        }

        // âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ localStorage í™•ì¸
        window.addEventListener('DOMContentLoaded', () => {
            const raw = localStorage.getItem('last_conversation');
            if (!raw) {
                // í…ŒìŠ¤íŠ¸ìš© ì˜ˆì‹œ ë°ì´í„°ë¡œ ì±„ìš°ê¸°
                const mockData = createMockFeedbackData();
                localStorage.setItem('last_conversation', JSON.stringify(mockData));
                console.log('Mock feedback data loaded for testing');
            }
        });

        // âœ… ë°±ê·¸ë¼ìš´ë“œì—ì„œ í”¼ë“œë°± ìƒì„± (feedback.html ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰)
        async function generateFeedbackInBackground() {
            try {
                const raw = localStorage.getItem('last_conversation');
                if (!raw) {
                    console.warn('[FEEDBACK_GEN] No conversation data found');
                    return;
                }

                const data = JSON.parse(raw);
                
                // ì´ë¯¸ í”¼ë“œë°±ì´ ìˆê±°ë‚˜ ìƒì„± ì¤‘ì´ ì•„ë‹ˆë©´ ìŠ¤í‚µ
                if (!data.isGenerating || data.feedbacks?.length > 0) {
                    console.log('[FEEDBACK_GEN] Feedback already exists or not needed');
                    return;
                }

                console.log('[FEEDBACK_GEN] Starting feedback generation for case:', data.caseId);

                // ì˜ì‚¬ ë°œì–¸ë§Œ ì¶”ì¶œ
                const doctorStatements = data.items
                    .filter(item => item.role === 'user')
                    .map(item => item.text)
                    .join('\n');

                const feedbackPrompt = `ë‹¹ì‹ ì€ ì¹˜ê³¼ ì˜ë£Œ êµìœ¡ìì…ë‹ˆë‹¤. ë‹¤ìŒ ì˜ì‚¬ì˜ ì§„ë£Œ ëŒ€í™”ë¥¼ í‰ê°€í•˜ì„¸ìš”.

ì˜ì‚¬ì˜ ë°œì–¸:
${doctorStatements}

5ë‹¨ê³„ì˜ ì§„ë£Œ íë¦„ì—ì„œ ê° ë‹¨ê³„ê°€ ì˜ ì´ë£¨ì–´ì¡ŒëŠ”ì§€ í‰ê°€í•˜ì„¸ìš”:
1. ì¸ì‚¬ ë° í™˜ì í™•ì¸
2. ë°©ë¬¸ ì´ìœ  í™•ì¸
3. ì •ë³´ ìˆ˜ì§‘ ë° ê³µê°
4. ì¹˜ë£Œ ê³„íš ì„¤ëª…
5. ì§„ë£Œ ë§ˆë¬´ë¦¬

ì‘ë‹µì€ ë°˜ë“œì‹œ ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”:
{"feedbacks": [{"stage": "1ë‹¨ê³„ ì´ë¦„", "done": true/false, "text": "í•œ ì¤„ í”¼ë“œë°±"}, ...]}`;

                const response = await fetch('/api/feedback', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        conversationHistory: data.items,
                        caseId: data.caseId,
                        prompt: feedbackPrompt
                    })
                });

                console.log('[FEEDBACK_GEN] API response status:', response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('[FEEDBACK_GEN] API error:', response.status, errorText);
                    return;
                }

                const feedbackData = await response.json();
                console.log('[FEEDBACK_GEN] Received feedback:', feedbackData);

                if (feedbackData.feedbacks) {
                    // í”¼ë“œë°± ì €ì¥
                    localStorage.setItem('last_conversation', JSON.stringify({
                        caseId: data.caseId,
                        items: data.items,
                        feedbacks: feedbackData.feedbacks,
                        isGenerating: false
                    }));

                    console.log('[FEEDBACK_GEN] Feedback saved and isGenerating set to false');
                    
                    // í”¼ë“œë°± ì¤€ë¹„ ì™„ë£Œ ì´ë²¤íŠ¸ ë°œì†¡
                    window.dispatchEvent(new CustomEvent('feedbackReady'));
                }
            } catch (error) {
                console.error('[FEEDBACK_GEN] Error generating feedback:', error);
            }
        }

        // âœ… í”¼ë“œë°± ìƒì„± ìƒíƒœ ê´€ë¦¬
        function renderConversation() {
            try {
                console.log('[RENDER_FEEDBACK] Starting renderConversation...');
                const raw = localStorage.getItem('last_conversation');
                if (!raw) {
                    console.warn('[RENDER_FEEDBACK] No conversation found in localStorage');
                    return;
                }
                
                const data = JSON.parse(raw);
                console.log('[RENDER_FEEDBACK] Data loaded:', {
                    caseId: data.caseId,
                    itemsCount: data.items?.length || 0,
                    feedbacksCount: data.feedbacks?.length || 0,
                    isGenerating: data.isGenerating
                });
                
                // âœ… ëŒ€í™” ë³µê¸°ëŠ” í•­ìƒ í‘œì‹œ
                const wrapper = document.getElementById('conversation-wrapper');
                if (!wrapper) {
                    console.error('[RENDER_FEEDBACK] conversation-wrapper not found');
                    return;
                }
                
                // ê¸°ì¡´ ë‚´ìš© ì œê±°
                wrapper.innerHTML = '';
                
                const imgMap = {
                    'lee-jiwon': 'lee-jiwon.png',
                    'jo-minseon': 'jo-minseon.png',
                    'oh-owan': 'oh-owan-guardian.png'
                };
                
                // ëŒ€í™” ë¸”ë¡ ìƒì„±
                const convBlock = document.createElement('div');
                convBlock.className = 'conversation-entry';
                
                data.items.forEach((item, turnIndex) => {
                    // ëŒ€í™” ë©”ì‹œì§€
                    const row = document.createElement('div');
                    row.className = 'chat-row ' + (item.role === 'user' ? 'me' : 'patient');
                    
                    if (item.role === 'patient') {
                        const img = document.createElement('img');
                        img.className = 'avatar';
                        const imgFile = imgMap[data.caseId] || '';
                        if (imgFile) img.src = `/after/images/${imgFile}`;
                        row.appendChild(img);
                        const bubble = document.createElement('div');
                        bubble.className = 'chat-bubble';
                        bubble.textContent = item.text;
                        row.appendChild(bubble);
                    } else {
                        const img = document.createElement('img');
                        img.className = 'avatar';
                        img.src = `/after/images/dentist.png`;
                        row.appendChild(img);
                        const bubble = document.createElement('div');
                        bubble.className = 'chat-bubble';
                        bubble.textContent = item.text;
                        row.appendChild(bubble);
                    }
                    convBlock.appendChild(row);
                });
                
                wrapper.appendChild(convBlock);
                
                // âœ… í”¼ë“œë°± ìƒíƒœì— ë”°ë¼ í”¼ë“œë°± ì„¹ì…˜ ì—…ë°ì´íŠ¸
                const loadingState = document.getElementById('loading-state');
                const feedbackContent = document.getElementById('feedback-content');
                
                if (data.isGenerating) {
                    console.log('[RENDER_FEEDBACK] Feedback is still generating, showing loading state');
                    // í”¼ë“œë°± ìƒì„± ì¤‘ - ìŠ¤í”¼ë„ˆ í‘œì‹œ, API ì‘ë‹µ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
                    loadingState.style.display = 'block';
                    feedbackContent.style.display = 'none';
                    console.log('[RENDER_FEEDBACK] Waiting for API feedback...');
                } else {
                    // í”¼ë“œë°± ìƒì„± ì™„ë£Œ
                    console.log('[RENDER_FEEDBACK] Feedback generation complete, showing content');
                    loadingState.style.display = 'none';
                    feedbackContent.style.display = 'block';
                    console.log('[RENDER_FEEDBACK] Rendering rubric with', data.feedbacks?.length || 0, 'feedbacks');
                    renderRubric(data.feedbacks);
                    
                    // 6ì´ˆ ë’¤ì— ì˜ˆì‹œ ì„¹ì…˜ í‘œì‹œ
                    setTimeout(() => {
                        const exampleSection = document.getElementById('example-section');
                        if (exampleSection) {
                            console.log('[RENDER_FEEDBACK] Showing example section');
                            exampleSection.style.display = 'block';
                        }
                    }, 6000);
                }
            } catch (e) {
                console.warn('Error rendering conversation:', e);
            }
        }

        // âœ… ë£¨ë¸Œë¦­ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderRubric(feedbacks) {
            console.log('[RENDER_RUBRIC] Starting with feedbacks:', feedbacks?.length || 0);
            
            const rubricDiv = document.getElementById('rubric-checklist');
            const improvementsSection = document.getElementById('improvements-section');
            const improvementsList = document.getElementById('improvements-list');
            
            if (!feedbacks || feedbacks.length === 0) {
                console.warn('[RENDER_RUBRIC] No feedbacks provided');
                rubricDiv.innerHTML = '<p style="text-align: center; color: var(--text-muted);">í”¼ë“œë°±ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            rubricDiv.innerHTML = '';
            const improvements = [];
            
            // 5ë‹¨ê³„ ë£¨ë¸Œë¦­ ìˆœì„œ
            const stages = ['1ë‹¨ê³„', '2ë‹¨ê³„', '3ë‹¨ê³„', '4ë‹¨ê³„', '5ë‹¨ê³„'];
            
            feedbacks.forEach((fb, idx) => {
                console.log(`[RENDER_RUBRIC] Processing feedback ${idx + 1}:`, {
                    stage: fb.stage,
                    done: fb.done,
                    text: fb.text?.substring(0, 50) + '...'
                });
                
                // stage ë¬¸ìì—´ì—ì„œ ë‹¨ê³„ ë²ˆí˜¸ ì¶”ì¶œ
                const stageNum = fb.stage.substring(0, 3); // "1ë‹¨ê³„" í˜•ì‹
                const isDone = fb.done === true;
                
                const item = document.createElement('div');
                item.className = 'ccg-item ' + (isDone ? 'pass' : 'fail');
                item.innerHTML = `
                    <span class="icon">${isDone ? 'V' : 'X'}</span>
                    <span>${fb.stage}</span>
                `;
                rubricDiv.appendChild(item);
                
                // ê°œì„  í•„ìš”í•œ í•­ëª© ìˆ˜ì§‘
                if (!isDone) {
                    improvements.push(fb.text);
                }
            });
            
            console.log('[RENDER_RUBRIC] Rendering complete with', improvements.length, 'improvements needed');
            
            // ê°œì„  í¬ì¸íŠ¸ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
            if (improvements.length > 0) {
                improvementsSection.style.display = 'block';
                improvementsList.innerHTML = improvements
                    .map(text => `<li>${text}</li>`)
                    .join('');
            } else {
                improvementsSection.style.display = 'none';
            }
        }

        // âœ… ì´ˆê¸° ë Œë”ë§
        console.log('[INIT] Starting initial render');
        renderConversation();
        
        // âœ… ë°±ê·¸ë¼ìš´ë“œì—ì„œ í”¼ë“œë°± ìƒì„± ì‹œì‘
        generateFeedbackInBackground();
        
        // âœ… 5ì´ˆ íƒ€ì´ë¨¸: í”¼ë“œë°± ìƒì„±ì´ ê³„ì† ì§„í–‰ ì¤‘ì´ë©´ ë¡œë”© ìˆ¨ê¹€
        const renderInterval = setInterval(() => {
            const raw = localStorage.getItem('last_conversation');
            if (raw) {
                const data = JSON.parse(raw);
                if (data.isGenerating) {
                    console.log('[TIMER] Feedback still generating, checking...');
                    // ì—¬ì „íˆ ìƒì„± ì¤‘ì´ë©´ renderConversation í˜¸ì¶œí•˜ì—¬ íƒ€ì„ì•„ì›ƒ ì²´í¬
                    renderConversation();
                }
            }
        }, 1000);  // 1ì´ˆë§ˆë‹¤ ì²´í¬
        
        // âœ… í”¼ë“œë°±ì´ ì™„ë£Œë˜ë©´ ë‹¤ì‹œ ë Œë”ë§
        window.addEventListener('feedbackReady', () => {
            console.log('[FEEDBACK_READY_EVENT] Feedback ready event received');
            // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ë‹¤ì‹œ ë Œë”ë§
            setTimeout(() => {
                console.log('[FEEDBACK_READY_EVENT] Re-rendering after event');
                renderConversation();
            }, 500);
        });

        document.getElementById('retry-btn')?.addEventListener('click', () => {
            location.href = 'simulation.html';
        });
        document.getElementById('back-to-cases-btn')?.addEventListener('click', () => {
            location.href = 'case-selection.html';
        });
    </script>
</body>
</html>        </section>